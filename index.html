<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹’ä¹“çƒèª²å ‚æé†’ç³»çµ± (å¤šå­¸å“¡ç‰ˆæœ¬)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
            touch-action: manipulation;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
        }
        .input-group {
            margin-bottom: 15px;
            position: relative;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }
        select, input[type="date"], input[type="text"], input[type="number"], input[type="tel"], textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 80px;
        }
        button {
            padding: 10px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
            font-size: 16px;
        }
        button:hover {
            background: #2980b9;
        }
        .live-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            margin-top: 20px;
            line-height: 1.5;
        }
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            width: 100%;
            justify-content: center;
            margin-top: 15px;
        }
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        .whatsapp-btn i {
            margin-right: 10px;
        }
        .copy-btn {
            background: #9b59b6;
        }
        .copy-btn:hover {
            background: #8e44ad;
        }
        .sync-btn {
            background: #2ecc71;
        }
        .sync-btn:hover {
            background: #27ae60;
        }
        .guide {
            background-color: #f0f7ff;
            padding: 15px;
            border-left: 4px solid #4CAF50;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        .guide h3 {
            margin-top: 0;
            color: #2c7be5;
        }
        .guide-step {
            margin-bottom: 10px;
            display: flex;
        }
        .step-number {
            background-color: #4CAF50;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            text-align: center;
            line-height: 25px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .tab-container {
            margin-bottom: 20px;
        }
        .tab {
            display: inline-block;
            padding: 10px 20px;
            background-color: #e0e0e0;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 0 5px 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
        .time-selector {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            width: 100%;
        }
        .selected-times {
            margin: 10px 0;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 4px;
            width: 100%;
        }
        .selected-time {
            font-weight: bold;
            color: #1565C0;
        }
        .duration-display {
            color: #666;
            font-size: 14px;
            margin-left: 10px;
        }
        .location-btns {
            display: grid;
            gap: 5px;
            margin-top: 5px;
            grid-template-columns: repeat(3, 1fr);
        }
        .location-btn {
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .location-btn.active {
            border: 2px solid #333;
            transform: scale(0.98);
        }
        #taiWaiBtn { background-color: #B3E5FC; }
        #austinBtn { background-color: #C8E6C9; }
        #tsuenWanBtn { background-color: #FFE0B2; }
        .reminder-preview {
            background-color: #e3f2fd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* è¡¨æ ¼æ¨£å¼ */
        .students-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .students-table th, .students-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .students-table th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        .students-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .students-table tr:hover {
            background-color: #f1f1f1;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .action-btns {
            display: flex;
            gap: 5px;
        }
        .action-btn {
            padding: 5px 8px;
            font-size: 12px;
            border-radius: 3px;
            cursor: pointer;
        }
        .add-row-btn {
            background-color: #4CAF50;
            color: white;
            margin-bottom: 10px;
        }
        .remove-row-btn {
            background-color: #f44336;
            color: white;
        }
        .preview-item {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .preview-item h4 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .batch-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .duration-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .duration-btn {
            padding: 8px 12px;
            background-color: #B3E5FC;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .duration-btn:hover {
            background-color: #81D4FA;
        }
        .duration-btn.active {
            background-color: #4CAF50;
            color: white;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            button {
                width: 100%;
                margin-bottom: 10px;
            }
            .tab {
                display: block;
                width: 100%;
                margin-bottom: 5px;
                border-radius: 5px;
            }
            .time-selector {
                flex-direction: column;
            }
            .location-btns {
                grid-template-columns: 1fr;
            }
            .students-table {
                font-size: 14px;
            }
            .students-table th, .students-table td {
                padding: 5px;
            }
            .action-btns {
                flex-direction: column;
            }
            .batch-actions {
                flex-direction: column;
            }
            .duration-buttons {
                flex-direction: column;
            }
            .duration-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä¹’ä¹“çƒèª²å ‚æé†’ç³»çµ± (å¤šå­¸å“¡ç‰ˆæœ¬)</h1>
        
        <!-- ä½¿ç”¨æŒ‡å— -->
        <div class="guide">
            <h3>ä½¿ç”¨æŒ‡å—</h3>
            <div class="guide-step">
                <div class="step-number">1</div>
                <div>åœ¨ã€ŒåŸºæœ¬è¨­å®šã€æ¨™ç±¤å¡«å¯«å…±ç”¨è³‡è¨Šå¦‚æ•™ç·´å’Œåœ°é»</div>
            </div>
            <div class="guide-step">
                <div class="step-number">2</div>
                <div>åœ¨ã€Œå­¸å“¡èª²å ‚ã€æ¨™ç±¤å¡«å¯«æ‰€æœ‰å­¸å“¡çš„ä¸Šèª²æ™‚é–“å’Œæ—¥æœŸ</div>
            </div>
            <div class="guide-step">
                <div class="step-number">3</div>
                <div>åœ¨ã€Œé è¦½ç™¼é€ã€æ¨™ç±¤æŸ¥çœ‹ä¸¦ç™¼é€æé†’è¨Šæ¯</div>
            </div>
        </div>

        <!-- æ¨™ç±¤å°èˆª -->
        <div class="tab-container">
            <div class="tab active" onclick="openTab('settings-tab')">åŸºæœ¬è¨­å®š</div>
            <div class="tab" onclick="openTab('students-tab')">å­¸å“¡èª²å ‚</div>
            <div class="tab" onclick="openTab('preview-tab')">é è¦½ç™¼é€</div>
        </div>

        <!-- åŸºæœ¬è¨­å®šæ¨™ç±¤ -->
        <div id="settings-tab" class="tab-content active">
            <div class="form-section">
                <h2>åŸºæœ¬è¨­å®š</h2>
                <div class="guide">
                    <p>è«‹å¡«å¯«æ‰€æœ‰èª²å ‚å…±ç”¨çš„åŸºæœ¬è³‡è¨Šï¼Œé€™äº›å°‡æ‡‰ç”¨æ–¼æ‰€æœ‰å­¸å“¡çš„æé†’è¨Šæ¯ä¸­ã€‚</p>
                </div>
                
                <div class="input-group">
                    <label>ğŸ« è² è²¬æ•™ç·´</label>
                    <input type="text" id="reminderCoachName" required placeholder="è«‹è¼¸å…¥æ•™ç·´å§“å">
                </div>

                <div class="input-group">
                    <label>ä¸Šèª²åœ°é»</label>
                    <div class="location-btns">
                        <div class="location-btn active" id="taiWaiBtn" onclick="selectLocation('ä¹’ä¹“åŒ¯æ™ºå¤§åœç¸½æ ¡', this)">å¤§åœç¸½æ ¡</div>
                        <div class="location-btn" id="austinBtn" onclick="selectLocation('ä¹’ä¹“åŒ¯æ™ºæŸ¯å£«ç”¸åˆ†æ ¡', this)">æŸ¯å£«ç”¸åˆ†æ ¡</div>
                        <div class="location-btn" id="tsuenWanBtn" onclick="selectLocation('ä¹’ä¹“åŒ¯æ™ºèƒç£åˆ†æ ¡', this)">èƒç£åˆ†æ ¡</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>é€šç”¨å‚™æ³¨</label>
                    <textarea id="commonRemarks" rows="3" placeholder="è¼¸å…¥é©ç”¨æ–¼æ‰€æœ‰å­¸å“¡çš„æ³¨æ„äº‹é …ï¼ˆå¦‚ï¼šç‰¹åˆ¥è£å‚™è¦æ±‚ã€å®¶é•·æ¥é€å®‰æ’ç­‰ï¼‰"></textarea>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <div></div> <!-- ç©ºdivç”¨æ–¼ä½”ä½ -->
                <button onclick="openTab('students-tab')">ä¸‹ä¸€æ­¥ï¼šå­¸å“¡èª²å ‚ <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- å­¸å“¡èª²å ‚æ¨™ç±¤ -->
        <div id="students-tab" class="tab-content">
            <div class="form-section">
                <h2>å­¸å“¡èª²å ‚è³‡è¨Š</h2>
                <div class="guide">
                    <p>è«‹åœ¨ä¸‹æ–¹è¡¨æ ¼ä¸­å¡«å¯«æ‰€æœ‰å­¸å“¡çš„ä¸Šèª²è³‡è¨Šã€‚æ–°å¢å­¸å“¡æ™‚ï¼Œé–‹å§‹æ™‚é–“æœƒè‡ªå‹•è¨­ç½®ç‚ºä¸Šä¸€ä½å­¸å“¡çš„çµæŸæ™‚é–“ã€‚</p>
                </div>
                
                <button class="add-row-btn" onclick="addStudentRow()"><i class="fas fa-plus"></i> æ·»åŠ å­¸å“¡</button>
                
                <div class="table-container">
                    <table class="students-table" id="studentsTable">
                        <thead>
                            <tr>
                                <th>å­¸ç”Ÿå§“å</th>
                                <th>ä¸Šèª²æ—¥æœŸ</th>
                                <th>é–‹å§‹æ™‚é–“</th>
                                <th>çµæŸæ™‚é–“</th>
                                <th>å‚™æ³¨</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- è¡Œå°‡ç”±JavaScriptå‹•æ…‹æ·»åŠ  -->
                        </tbody>
                    </table>
                </div>

                <div class="input-group">
                    <label>å¿«é€Ÿè¨­ç½®èª²å ‚æ™‚é•·</label>
                    <div class="duration-buttons">
                        <button class="duration-btn" onclick="setDurationForSelected(1)">1å°æ™‚</button>
                        <button class="duration-btn" onclick="setDurationForSelected(1.5)">1.5å°æ™‚</button>
                        <button class="duration-btn" onclick="setDurationForSelected(2)">2å°æ™‚</button>
                        <button class="duration-btn" onclick="setDurationForSelected(2.5)">2.5å°æ™‚</button>
                    </div>
                    <p class="duration-display">é¸ä¸­è¡Œå¾Œé»æ“ŠæŒ‰éˆ•å¯å¿«é€Ÿè¨­ç½®çµæŸæ™‚é–“</p>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button onclick="openTab('settings-tab')"><i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥ï¼šåŸºæœ¬è¨­å®š</button>
                <button onclick="openTab('preview-tab'); updateReminderPreview();">ä¸‹ä¸€æ­¥ï¼šé è¦½ç™¼é€ <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- é è¦½ç™¼é€æ¨™ç±¤ -->
        <div id="preview-tab" class="tab-content">
            <div class="form-section">
                <h2>é è¦½èˆ‡ç™¼é€</h2>
                <div class="guide">
                    <p>ä»¥ä¸‹æ˜¯æ ¹æ“šæ‚¨è¼¸å…¥çš„è³‡æ–™ç”Ÿæˆçš„æ‰€æœ‰æé†’è¨Šæ¯ï¼Œè«‹ç¢ºèªç„¡èª¤å¾Œé¸æ“‡ç™¼é€æ–¹å¼ã€‚</p>
                </div>
                
                <div class="batch-actions">
                    <button onclick="updateReminderPreview()"><i class="fas fa-sync-alt"></i> æ›´æ–°é è¦½</button>
                    <button onclick="copyAllReminders()" class="copy-btn"><i class="fas fa-copy"></i> è¤‡è£½å…¨éƒ¨å…§å®¹</button>
                    <button onclick="sendAllWhatsApp()" class="whatsapp-btn"><i class="fab fa-whatsapp"></i> ç™¼é€å…¨éƒ¨åˆ° WhatsApp</button>
                </div>
                
                <h3>é è¦½è¨Šæ¯ï¼š</h3>
                <div id="allMessagesPreview">
                    <!-- é è¦½å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button onclick="openTab('students-tab')"><i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥ï¼šå­¸å“¡èª²å ‚</button>
                <div></div> <!-- ç©ºdivç”¨æ–¼ä½”ä½ -->
            </div>
        </div>
    </div>

    <script>
        // æ™‚é–“æ®µé…ç½®
        const timeOptions = [];
        for (let hour = 8; hour < 22; hour++) {
            for (let minute = 0; minute < 60; minute += 15) {
                const time = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                timeOptions.push(time);
            }
        }

        let selectedLocation = 'ä¹’ä¹“åŒ¯æ™ºå¤§åœç¸½æ ¡';
        let storedCoachName = '';
        let lastEndTime = ''; // è¨˜éŒ„æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
        let selectedRow = null; // ç•¶å‰é¸ä¸­çš„è¡Œ

        // æ¨™ç±¤åˆ‡æ›åŠŸèƒ½
        function openTab(tabId) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„activeé¡
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹
            document.getElementById(tabId).classList.add('active');
            
            // ç‚ºé¸ä¸­çš„æ¨™ç±¤æ·»åŠ activeé¡
            event.currentTarget.classList.add('active');
        }

        // æ·»åŠ å­¸å“¡è¡Œ
        function addStudentRow(studentData = {}) {
            const tbody = document.querySelector('#studentsTable tbody');
            const row = document.createElement('tr');
            
            // è¨­ç½®é»˜èªæ—¥æœŸç‚ºä»Šå¤©
            const today = new Date();
            const defaultDate = today.toISOString().split('T')[0];
            
            // å¦‚æœæ²’æœ‰æŒ‡å®šé–‹å§‹æ™‚é–“ï¼Œä½¿ç”¨ä¸Šä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
            let defaultStartTime = studentData.startTime || lastEndTime || '';
            
            row.innerHTML = `
                <td><input type="text" class="student-name" value="${studentData.name || ''}" placeholder="å­¸ç”Ÿå§“å" required></td>
                <td><input type="date" class="class-date" value="${studentData.date || defaultDate}" required></td>
                <td>
                    <select class="start-time" required>
                        <option value="">é¸æ“‡æ™‚é–“</option>
                        ${timeOptions.map(time => 
                            `<option value="${time}" ${defaultStartTime === time ? 'selected' : ''}>${time}</option>`
                        ).join('')}
                    </select>
                </td>
                <td>
                    <select class="end-time" required>
                        <option value="">é¸æ“‡æ™‚é–“</option>
                        ${timeOptions.map(time => 
                            `<option value="${time}" ${studentData.endTime === time ? 'selected' : ''}>${time}</option>`
                        ).join('')}
                    </select>
                    <div class="duration-display">${defaultStartTime && studentData.endTime ? formatDuration(calculateDuration(defaultStartTime, studentData.endTime)) : ''}</div>
                </td>
                <td><input type="text" class="remarks" value="${studentData.remarks || ''}" placeholder="å€‹äººå‚™æ³¨"></td>
                <td class="action-btns">
                    <button class="action-btn remove-row-btn" onclick="removeStudentRow(this)"><i class="fas fa-trash"></i> åˆªé™¤</button>
                </td>
            `;
            
            // æ·»åŠ äº‹ä»¶ç›£è½å™¨ä¾†æ›´æ–°æŒçºŒæ™‚é–“é¡¯ç¤º
            const startSelect = row.querySelector('.start-time');
            const endSelect = row.querySelector('.end-time');
            const durationDisplay = row.querySelector('.duration-display');
            
            startSelect.addEventListener('change', function() {
                updateRowDuration(row);
                // æ›´æ–°æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
                updateLastEndTime();
            });
            
            endSelect.addEventListener('change', function() {
                updateRowDuration(row);
                // æ›´æ–°æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
                updateLastEndTime();
            });
            
            // æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œé¸ä¸­è¡Œ
            row.addEventListener('click', function() {
                selectRow(this);
            });
            
            tbody.appendChild(row);
            
            // æ›´æ–°æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
            updateLastEndTime();
            
            // é¸ä¸­æ–°æ·»åŠ çš„è¡Œ
            selectRow(row);
            
            return row;
        }

        // é¸ä¸­è¡Œ
        function selectRow(row) {
            // ç§»é™¤ä¹‹å‰é¸ä¸­è¡Œçš„æ¨£å¼
            document.querySelectorAll('#studentsTable tbody tr').forEach(r => {
                r.style.backgroundColor = '';
            });
            
            // è¨­ç½®æ–°é¸ä¸­è¡Œçš„æ¨£å¼
            row.style.backgroundColor = '#e3f2fd';
            selectedRow = row;
        }

        // åˆªé™¤å­¸å“¡è¡Œ
        function removeStudentRow(button) {
            const row = button.closest('tr');
            row.remove();
            // æ›´æ–°æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
            updateLastEndTime();
        }

        // æ›´æ–°è¡Œçš„æŒçºŒæ™‚é–“é¡¯ç¤º
        function updateRowDuration(row) {
            const startTime = row.querySelector('.start-time').value;
            const endTime = row.querySelector('.end-time').value;
            const durationDisplay = row.querySelector('.duration-display');
            
            if (startTime && endTime) {
                const duration = calculateDuration(startTime, endTime);
                durationDisplay.textContent = formatDuration(duration);
            } else {
                durationDisplay.textContent = '';
            }
        }

        // æ›´æ–°æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
        function updateLastEndTime() {
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (rows.length > 0) {
                const lastRow = rows[rows.length - 1];
                lastEndTime = lastRow.querySelector('.end-time').value;
            } else {
                lastEndTime = '';
            }
        }

        // ç‚ºé¸ä¸­è¡Œè¨­ç½®æŒçºŒæ™‚é–“
        function setDurationForSelected(hours) {
            if (!selectedRow) {
                alert('è«‹å…ˆé¸ä¸­è¦è¨­ç½®çš„å­¸å“¡è¡Œï¼');
                return;
            }
            
            const startTime = selectedRow.querySelector('.start-time').value;
            if (!startTime) {
                alert('è«‹å…ˆè¨­ç½®é–‹å§‹æ™‚é–“ï¼');
                return;
            }
            
            // è¨ˆç®—çµæŸæ™‚é–“
            const [startHour, startMinute] = startTime.split(':').map(Number);
            const totalMinutes = startHour * 60 + startMinute + Math.round(hours * 60);
            const endHour = Math.floor(totalMinutes / 60);
            const endMinute = totalMinutes % 60;
            const endTime = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;
            
            // è¨­ç½®çµæŸæ™‚é–“
            const endSelect = selectedRow.querySelector('.end-time');
            endSelect.value = endTime;
            
            // æ›´æ–°æŒçºŒæ™‚é–“é¡¯ç¤º
            updateRowDuration(selectedRow);
            
            // æ›´æ–°æœ€å¾Œä¸€å€‹å­¸å“¡çš„çµæŸæ™‚é–“
            updateLastEndTime();
        }

        // è¨ˆç®—æŒçºŒæ™‚é–“
        function calculateDuration(start, end) {
            if (!start || !end) return 0;
            
            const startHour = parseInt(start.substring(0, 2));
            const startMinute = parseInt(start.substring(3));
            const endHour = parseInt(end.substring(0, 2));
            const endMinute = parseInt(end.substring(3));
            
            const startTotal = startHour * 60 + startMinute;
            const endTotal = endHour * 60 + endMinute;
            
            return (endTotal - startTotal) / 60; // è½‰æ›ç‚ºå°æ™‚
        }

        // æ ¼å¼åŒ–æŒçºŒæ™‚é–“é¡¯ç¤º
        function formatDuration(duration) {
            if (duration <= 0) return '0å°æ™‚';
            
            const hours = Math.floor(duration);
            const minutes = Math.round((duration % 1) * 60);
            
            if (minutes === 0) {
                return `${hours}å°æ™‚`;
            } else {
                return `${hours}å°æ™‚${minutes}åˆ†é˜`;
            }
        }

        // é¸æ“‡åœ°é»
        function selectLocation(location, element) {
            selectedLocation = location;
            document.querySelectorAll('.location-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
        }

        // ç”Ÿæˆå–®å€‹å­¸å“¡çš„æé†’è¨Šæ¯
        function generateStudentReminder(studentData) {
            const date = studentData.date;
            const student = studentData.name;
            const coach = document.getElementById('reminderCoachName').value || 'æœªå¡«å¯«';
            const remarks = studentData.remarks || '';
            const commonRemarks = document.getElementById('commonRemarks').value || '';
            const duration = calculateDuration(studentData.startTime, studentData.endTime);

            // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
            let formattedDate = date;
            if (date) {
                const dateObj = new Date(date);
                const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
                const dayOfWeek = days[dateObj.getDay()];
                formattedDate = `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, '0')}-${String(dateObj.getDate()).padStart(2, '0')}ï¼ˆé€±${dayOfWeek}ï¼‰`;
            }

            return `ã€${student} - ä¹’ä¹“çƒèª²å ‚æé†’ã€‘
ğŸ—“ æ—¥æœŸï¼š${formattedDate || 'æœªå¡«å¯«'}
â° æ™‚é–“ï¼š${studentData.startTime || 'æœªé¸æ“‡'} - ${studentData.endTime || 'æœªé¸æ“‡'} (${formatDuration(duration)})
ğŸ“ åœ°é»ï¼š${selectedLocation}
ğŸ“ å­¸ç”Ÿï¼š${student}
ğŸ« æ•™ç·´ï¼š${coach}

æº«é¦¨æç¤ºï¼š
1. è«‹æå‰10åˆ†é˜åˆ°æ ¡
2. åˆ°é”å¾Œå¯è‡ªè¡Œç†±èº«
3. è«‹æº–å‚™å¥½çƒæ‹ã€é‹å‹•æœè£å’Œé£²ç”¨æ°´
4. åˆ°é”å¾Œè«‹å‘${coach}æ•™ç·´å ±åˆ°

${remarks ? `å€‹äººå‚™æ³¨ï¼š\n${remarks}\n\n` : ''}${commonRemarks ? `é€šç”¨å‚™æ³¨ï¼š\n${commonRemarks}` : ''}`;
        }

        // æ›´æ–°æ‰€æœ‰æé†’é è¦½
        function updateReminderPreview() {
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!validateForm()) {
                return;
            }
            
            // å„²å­˜æ•™ç·´åç¨±ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨
            storedCoachName = document.getElementById('reminderCoachName').value;
            
            const previewContainer = document.getElementById('allMessagesPreview');
            previewContainer.innerHTML = '';
            
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (rows.length === 0) {
                previewContainer.innerHTML = '<p>æ²’æœ‰å­¸å“¡è³‡æ–™ï¼Œè«‹è¿”å›ã€Œå­¸å“¡èª²å ‚ã€æ¨™ç±¤æ·»åŠ å­¸å“¡ã€‚</p>';
                return;
            }
            
            rows.forEach((row, index) => {
                const studentData = {
                    name: row.querySelector('.student-name').value,
                    date: row.querySelector('.class-date').value,
                    startTime: row.querySelector('.start-time').value,
                    endTime: row.querySelector('.end-time').value,
                    remarks: row.querySelector('.remarks').value
                };
                
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.innerHTML = `
                    <h4>æé†’è¨Šæ¯ #${index + 1} - ${studentData.name}</h4>
                    <div class="reminder-preview">${generateStudentReminder(studentData)}</div>
                    <div class="action-btns">
                        <button onclick="copySingleReminder(${index})" class="copy-btn"><i class="fas fa-copy"></i> è¤‡è£½æ­¤è¨Šæ¯</button>
                        <button onclick="sendSingleWhatsApp(${index})" class="whatsapp-btn"><i class="fab fa-whatsapp"></i> ç™¼é€æ­¤è¨Šæ¯</button>
                    </div>
                `;
                
                previewContainer.appendChild(previewItem);
            });
        }

        // è¤‡è£½å–®å€‹æé†’
        function copySingleReminder(index) {
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (index >= rows.length) return;
            
            const row = rows[index];
            const studentData = {
                name: row.querySelector('.student-name').value,
                date: row.querySelector('.class-date').value,
                startTime: row.querySelector('.start-time').value,
                endTime: row.querySelector('.end-time').value,
                remarks: row.querySelector('.remarks').value
            };
            
            const text = generateStudentReminder(studentData);
            navigator.clipboard.writeText(text).then(() => {
                alert(`å·²è¤‡è£½ ${studentData.name} çš„æé†’è¨Šæ¯åˆ°å‰ªè²¼ç°¿ï¼`);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–é è¦½å…§å®¹é€²è¡Œè¤‡è£½ã€‚');
            });
        }

        // è¤‡è£½æ‰€æœ‰æé†’
        function copyAllReminders() {
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!validateForm()) {
                return;
            }
            
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (rows.length === 0) {
                alert('æ²’æœ‰å­¸å“¡è³‡æ–™å¯è¤‡è£½ï¼');
                return;
            }
            
            let allText = '';
            
            rows.forEach((row, index) => {
                const studentData = {
                    name: row.querySelector('.student-name').value,
                    date: row.querySelector('.class-date').value,
                    startTime: row.querySelector('.start-time').value,
                    endTime: row.querySelector('.end-time').value,
                    remarks: row.querySelector('.remarks').value
                };
                
                allText += generateStudentReminder(studentData);
                allText += '\n\n--------------------------------\n\n';
            });
            
            navigator.clipboard.writeText(allText).then(() => {
                alert(`å·²è¤‡è£½ ${rows.length} å€‹å­¸å“¡çš„æé†’è¨Šæ¯åˆ°å‰ªè²¼ç°¿ï¼`);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–é è¦½å…§å®¹é€²è¡Œè¤‡è£½ã€‚');
            });
        }

        // ç™¼é€å–®å€‹æé†’åˆ°WhatsApp
        function sendSingleWhatsApp(index) {
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (index >= rows.length) return;
            
            const row = rows[index];
            const studentData = {
                name: row.querySelector('.student-name').value,
                date: row.querySelector('.class-date').value,
                startTime: row.querySelector('.start-time').value,
                endTime: row.querySelector('.end-time').value,
                remarks: row.querySelector('.remarks').value
            };
            
            const message = encodeURIComponent(generateStudentReminder(studentData));
            window.open(`https://wa.me/?text=${message}`);
        }

        // ç™¼é€æ‰€æœ‰æé†’åˆ°WhatsApp
        function sendAllWhatsApp() {
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!validateForm()) {
                return;
            }
            
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (rows.length === 0) {
                alert('æ²’æœ‰å­¸å“¡è³‡æ–™å¯ç™¼é€ï¼');
                return;
            }
            
            let allText = '';
            
            rows.forEach(row => {
                const studentData = {
                    name: row.querySelector('.student-name').value,
                    date: row.querySelector('.class-date').value,
                    startTime: row.querySelector('.start-time').value,
                    endTime: row.querySelector('.end-time').value,
                    remarks: row.querySelector('.remarks').value
                };
                
                allText += generateStudentReminder(studentData);
                allText += '\n\n--------------------------------\n\n';
            });
            
            const message = encodeURIComponent(allText);
            window.open(`https://wa.me/?text=${message}`);
        }

        // è¡¨å–®é©—è­‰
        function validateForm() {
            // é©—è­‰æ•™ç·´åç¨±
            const coachName = document.getElementById('reminderCoachName').value.trim();
            if (!coachName) {
                alert('è«‹å…ˆå¡«å¯«è² è²¬æ•™ç·´å§“åï¼');
                openTab('settings-tab');
                return false;
            }
            
            // é©—è­‰å­¸å“¡è³‡æ–™
            const rows = document.querySelectorAll('#studentsTable tbody tr');
            if (rows.length === 0) {
                alert('è«‹è‡³å°‘æ·»åŠ ä¸€å€‹å­¸å“¡çš„èª²å ‚è³‡æ–™ï¼');
                openTab('students-tab');
                return false;
            }
            
            let hasError = false;
            let errorMessages = [];
            
            rows.forEach((row, index) => {
                const studentName = row.querySelector('.student-name').value.trim();
                const date = row.querySelector('.class-date').value;
                const startTime = row.querySelector('.start-time').value;
                const endTime = row.querySelector('.end-time').value;
                
                if (!studentName) {
                    hasError = true;
                    errorMessages.push(`ç¬¬ ${index + 1} è¡Œï¼šç¼ºå°‘å­¸ç”Ÿå§“å`);
                }
                
                if (!date) {
                    hasError = true;
                    errorMessages.push(`ç¬¬ ${index + 1} è¡Œï¼šç¼ºå°‘ä¸Šèª²æ—¥æœŸ`);
                }
                
                if (!startTime) {
                    hasError = true;
                    errorMessages.push(`ç¬¬ ${index + 1} è¡Œï¼šç¼ºå°‘é–‹å§‹æ™‚é–“`);
                }
                
                if (!endTime) {
                    hasError = true;
                    errorMessages.push(`ç¬¬ ${index + 1} è¡Œï¼šç¼ºå°‘çµæŸæ™‚é–“`);
                }
                
                if (startTime && endTime) {
                    const duration = calculateDuration(startTime, endTime);
                    if (duration <= 0) {
                        hasError = true;
                        errorMessages.push(`ç¬¬ ${index + 1} è¡Œï¼šçµæŸæ™‚é–“å¿…é ˆæ™šæ–¼é–‹å§‹æ™‚é–“`);
                    }
                }
            });
            
            if (hasError) {
                alert('è«‹ä¿®æ­£ä»¥ä¸‹éŒ¯èª¤ï¼š\n\n' + errorMessages.join('\n'));
                openTab('students-tab');
                return false;
            }
            
            return true;
        }

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ åˆå§‹è¡Œ
            addStudentRow();
            
            // å¦‚æœä¹‹å‰æœ‰å„²å­˜æ•™ç·´åç¨±ï¼Œå‰‡æ¢å¾©
            if (storedCoachName) {
                document.getElementById('reminderCoachName').value = storedCoachName;
            }
            
            // åˆå§‹æ›´æ–°é è¦½
            updateReminderPreview();
        });
    </script>
</body>
</html>
